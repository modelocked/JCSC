% =====================================================================
% Style_Formatting/Document_Formatting.tex
% Maynooth University Thesis Formatting (Appendix 5 compliant)
% Clean version: XeLaTeX/LuaLaTeX required, no BibLaTeX conflicts
% =====================================================================

% -------------------------------------------------
% Enforce XeLaTeX or LuaLaTeX (required for Times New Roman)
\RequirePackage{iftex}
\ifPDFTeX
\errmessage{***************************************************}
\errmessage{* This document REQUIRES XeLaTeX or LuaLaTeX.     *}
\errmessage{* Please switch your compiler from pdfLaTeX.      *}
\errmessage{***************************************************}
\fi

% -------------------------------------------------
% Fonts: Times New Roman 12pt with Arial and Courier New
\RequirePackage{fontspec}
\setmainfont{Times New Roman} % Main text
\setsansfont{Arial}            % Sans serif
\setmonofont{Courier New}      % Monospace

% -------------------------------------------------
% Page layout: margins 40mm left, 20mm right, 25mm top/bottom
\RequirePackage[left=40mm,right=20mm,top=25mm,bottom=25mm]{geometry}

% -------------------------------------------------
% Line spacing: double throughout; single for abstract
\RequirePackage{setspace}
\doublespacing
\newenvironment{thesisabstract}
{\begin{singlespace}\begin{abstract}}
		{\end{abstract}\end{singlespace}}

% -------------------------------------------------
% Numbering and ToC depth
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

% -------------------------------------------------
% Prevent widows and orphans; avoid vertical stretch
\clubpenalty=10000
\widowpenalty=10000
\raggedbottom

% -------------------------------------------------
% Headings (KOMA-Script native, no titlesec)
\RequirePackage{scrlayer-scrpage}
\RequirePackage{etoolbox}

% Centre chapter headings
\renewcommand*\raggedchapter{\centering}

% Heading fonts
\setkomafont{chapter}{\normalfont\LARGE\bfseries}
\setkomafont{section}{\normalfont\Large\bfseries}
\setkomafont{subsection}{\normalfont\itshape\normalsize}

% Spacing before/after headings
\RedeclareSectionCommand[
beforeskip=-3.5ex plus -1ex minus -.2ex,
afterskip=2.3ex plus .2ex]{chapter}
\RedeclareSectionCommand[
beforeskip=2.5ex plus 1ex minus .2ex,
afterskip=1.5ex plus .2ex]{section}
\RedeclareSectionCommand[
beforeskip=2.0ex plus .8ex minus .2ex,
afterskip=1.0ex plus .2ex]{subsection}

% Uppercase CHAPTER label and title
\makeatletter
\renewcommand*\chapterlinesformat[3]{%
	\ifdefstring{#1}{chapter}{%
		{\setkomafont{chapter}\centering \MakeUppercase{#2}\par}%
		\vspace{.6\baselineskip}%
		{\setkomafont{chapter}\centering \MakeUppercase{#3}}%
	}{%
		\@hangfrom{\hskip\leftskip #2}{#3}%
	}%
}
\makeatother

% -------------------------------------------------
% Front/Main/Back matter helpers
\providecommand*{\frontmatter}{\pagenumbering{roman}}
\providecommand*{\mainmatter}{\clearpage\pagenumbering{arabic}}
\providecommand*{\backmatter}{\clearpage}

% -------------------------------------------------
% Unnumbered chapters/sections for proposals (added to ToC)
\newcommand{\proposalchapter}[2][]{%
	\chapter*{#2}%
	\addcontentsline{toc}{chapter}{\if\relax\detokenize{#1}\relax #2\else #1\fi}%
	\markboth{#2}{#2}%
}
\newcommand{\proposalsection}[2][]{%
	\section*{#2}%
	\addcontentsline{toc}{section}{\if\relax\detokenize{#1}\relax #2\else #1\fi}%
}

% -------------------------------------------------
% Robust line breaking for long URLs
\sloppy

% -------------------------------------------------
% Header/Footer height adjustments (silences warnings)
\setlength{\headheight}{25pt}
\setlength{\footskip}{30pt}

% =====================================================================
% End of Document_Formatting.tex
% =====================================================================
