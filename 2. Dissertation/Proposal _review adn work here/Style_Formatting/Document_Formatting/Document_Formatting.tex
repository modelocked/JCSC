% Style_Formatting/Document_Formatting.tex
% Maynooth University Thesis Formatting (Appendix 5)
% Uses KOMA-Script-native heading controls (no 'titlesec' warnings)

% -------------------------------------------------
% Enforce XeLaTeX or LuaLaTeX (required for Times New Roman)
\RequirePackage{iftex}
\ifPDFTeX
\errmessage{***************************************************}
\errmessage{* This document REQUIRES XeLaTeX or LuaLaTeX.     *}
\errmessage{* Please switch your compiler from pdfLaTeX.      *}
\errmessage{***************************************************}
\fi

% -------------------------------------------------
% Fonts: Times New Roman 12pt
\RequirePackage{fontspec}
\setmainfont{Times New Roman} % Main text
\setsansfont{Arial}            % Sans serif
\setmonofont{Courier New}      % Monospace

% -------------------------------------------------
% Margins: 40mm left, 20mm right, 25mm top/bottom
\RequirePackage[left=40mm,right=20mm,top=25mm,bottom=25mm]{geometry}

% -------------------------------------------------
% Line spacing: Double by default
\RequirePackage{setspace}
\doublespacing

% Abstract: single-spaced environment
\newenvironment{thesisabstract}
{\begin{singlespace}\begin{abstract}}
		{\end{abstract}\end{singlespace}}

% -------------------------------------------------
% Numbering depth & ToC depth (chapters/sections only)
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

% -------------------------------------------------
% Prevent widows and orphans; avoid vertical stretch
\clubpenalty=10000
\widowpenalty=10000
\raggedbottom

% -------------------------------------------------
% KOMA-Script heading configuration (Appendix 5 rules)
% Chapter: centred + capitals; Section: Bold, left; Subsection: Italic, left
\RequirePackage{scrlayer-scrpage} % safe with KOMA
\RequirePackage{etoolbox}         % for \ifdefstring

% Centre chapter headings
\renewcommand*\raggedchapter{\centering}

% Set heading fonts
\setkomafont{chapter}{\normalfont\LARGE\bfseries}
\setkomafont{section}{\normalfont\Large\bfseries}
\setkomafont{subsection}{\normalfont\itshape\normalsize}

% Ensure reasonable vertical spacing for headings
\RedeclareSectionCommand[beforeskip=-3.5ex plus -1ex minus -.2ex,afterskip=2.3ex plus .2ex]{chapter}
\RedeclareSectionCommand[beforeskip=2.5ex plus 1ex minus .2ex,afterskip=1.5ex plus .2ex]{section}
\RedeclareSectionCommand[beforeskip=2.0ex plus .8ex minus .2ex,afterskip=1.0ex plus .2ex]{subsection}

% Uppercase chapter label and title (without titlesec)
\makeatletter
% Print CHAPTER N on its own line, then uppercase title on next line
\renewcommand*\chapterlinesformat[3]{%
	\ifdefstring{#1}{chapter}{%
		{\setkomafont{chapter}\centering \MakeUppercase{#2}\par}%
		\vspace{.6\baselineskip}%
		{\setkomafont{chapter}\centering \MakeUppercase{#3}}%
	}{%
		% default for other levels
		\@hangfrom{\hskip\leftskip #2}{#3}%
	}%
}
\makeatother

% -------------------------------------------------
% Define front/main/back matter if missing (for proposal documents)
\providecommand*{\frontmatter}{\pagenumbering{roman}}
\providecommand*{\mainmatter}{\clearpage\pagenumbering{arabic}}
\providecommand*{\backmatter}{\clearpage}

% -------------------------------------------------
% Helpers for unnumbered proposal-style chapters/sections (add to ToC)
\newcommand{\proposalchapter}[2][]{%
	\chapter*{#2}%
	\addcontentsline{toc}{chapter}{\if\relax\detokenize{#1}\relax #2\else #1\fi}%
	\markboth{#2}{#2}%
}

\newcommand{\proposalsection}[2][]{%
	\section*{#2}%
	\addcontentsline{toc}{section}{\if\relax\detokenize{#1}\relax #2\else #1\fi}%
}

% -------------------------------------------------
% Robust line breaking for long URLs
\sloppy
